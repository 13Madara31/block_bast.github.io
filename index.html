<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Block Blast Game</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/modal.css">
</head>
<body>
    <main class="container fade-in">
        <h1 class="game-title">üí• Block Blast</h1>
        <p class="game-subtitle">–°–æ–±–∏—Ä–∞–π –±–ª–æ–∫–∏, —Å—Ç–∞–≤—å —Ä–µ–∫–æ—Ä–¥—ã! üéØ</p>
        
        <div class="buttons-container">
            <button class="btn btn-play" onclick="startGame()">
                üéÆ –ò–≥—Ä–∞—Ç—å
            </button>
            <button class="btn btn-ranking" onclick="showRanking()">
                üèÜ –†–µ–π—Ç–∏–Ω–≥
            </button>
            <button class="btn btn-shop" onclick="showShop()">
                üõí –ú–∞–≥–∞–∑–∏–Ω
            </button>
        </div>
        
        <div class="high-score">
            <div>üèÜ –ú–æ–π —Ä–µ–∫–æ—Ä–¥</div>
            <div class="score-number" id="highScore">0</div>
        </div>

        <div class="selected-role-display">
            <div>–í–∞—à–∞ —Ä–æ–ª—å:</div>
            <div id="currentRole" class="role-name">–ù–µ –≤—ã–±—Ä–∞–Ω–∞</div>
        </div>
    </main>

    <!-- Modal Window for Character Selection -->
    <div id="characterSelectModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="modal-title">–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–µ–≥–æ –≥–µ—Ä–æ—è</h2>
            <div class="character-cards-container">
                <div class="character-card" data-character="–∞—Ä—Ö–∏–º–∞–≥">
                    <img src="Orange Girl Wallpaper üî∏.jpg" alt="–ê—Ä—Ö–∏–º–∞–≥">
                    <h3>–ê—Ä—Ö–∏–º–∞–≥</h3>
                </div>
                <div class="character-card" data-character="–ø—Ä–æ–≤–∏–¥–µ—Ü">
                    <img src="–∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ (3).jpg" alt="–ü—Ä–æ–≤–∏–¥–µ—Ü">
                    <h3>–ü—Ä–æ–≤–∏–¥–µ—Ü</h3>
                </div>
                <div class="character-card" data-character="–∏–Ω–∂–µ–Ω–µ—Ä">
                    <img src="–∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ (2).jpg" alt="–ò–Ω–∂–µ–Ω–µ—Ä">
                    <h3>–ò–Ω–∂–µ–Ω–µ—Ä</h3>
                </div>
                <div class="character-card secret-card" data-character="–º–æ–Ω–∞—Ä—Ö—Ç–µ–Ω–µ–π" style="display: none;">
                    <img src="–∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ (1).jpg" alt="–ú–æ–Ω–∞—Ä—Ö –¢–µ–Ω–µ–π">
                    <h3>–ú–æ–Ω–∞—Ä—Ö –¢–µ–Ω–µ–π</h3>
                </div>
            </div>
            <div class="character-description-area">
                <p id="characterDescription">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ.</p>
            </div>
            <button id="selectCharacterBtn" class="btn btn-modal-select" disabled>–í—ã–±—Ä–∞—Ç—å</button>
            <button id="settingsBtn" class="btn-settings-icon">
                ‚öôÔ∏è
            </button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="modal-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            <div class="settings-option">
                <span>–ú—É–∑—ã–∫–∞</span>
                <label class="switch">
                    <input type="checkbox" id="musicToggle" checked>
                    <span class="slider round"></span>
                </label>
            </div>
            <div class="settings-option">
                <span>–ó–≤—É–∫–∏</span>
                <label class="switch">
                    <input type="checkbox" id="soundToggle" checked>
                    <span class="slider round"></span>
                </label>
            </div>
            <button id="reloadBtn" class="btn btn-reload">–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
            <button class="btn-close-settings-modal">‚úñ</button>
        </div>
    </div>

    <!-- Ranking Modal -->
    <div id="rankingModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="modal-title">üèÜ –†–µ–π—Ç–∏–Ω–≥</h2>
            <div id="rankingList" class="ranking-list"></div>
            <button class="btn-close-ranking-modal">‚úñ</button>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∫–æ—Ä–¥ –∏–∑ localStorage –∏ —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —ç—Ç–æ —á–∏—Å–ª–æ
        let highScore = parseInt(localStorage.getItem('blockBlastHighScore'), 10);
        if (isNaN(highScore) || highScore < 0) {
            highScore = 0;
            localStorage.setItem('blockBlastHighScore', 0); // –û—á–∏—â–∞–µ–º –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞
        document.getElementById('highScore').textContent = formatNumber(highScore);
        
        // JavaScript –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤—ã–±–æ—Ä–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        const characterSelectModal = document.getElementById('characterSelectModal');
        const characterCards = document.querySelectorAll('.character-card');
        const characterDescription = document.getElementById('characterDescription');
        const selectCharacterBtn = document.getElementById('selectCharacterBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsModal = document.getElementById('settingsModal');
        const closeSettingsModalBtn = document.querySelector('.btn-close-settings-modal');
        const musicToggle = document.getElementById('musicToggle');
        const soundToggle = document.getElementById('soundToggle');
        const reloadBtn = document.getElementById('reloadBtn');
        const currentRoleDisplay = document.getElementById('currentRole'); // –ù–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–æ–ª–∏
        
        let selectedCharacter = null;
        let reloadCount = 0; // –î–ª—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏

        const characterDescriptions = {
            –∞—Ä—Ö–∏–º–∞–≥: 'üî• –ú–∞–≥–∏—á–µ—Å–∫–∞—è –û—á–∏—Å—Ç–∫–∞ - —É–±–∏—Ä–∞–µ—Ç 2 –ª—é–±—ã–µ –ª–∏–Ω–∏–∏ (1 —Ä–∞–∑ –∑–∞ –∏–≥—Ä—É)\nüîÆ –ü—Ä–∏–∑—ã–≤ –ù—É–∂–Ω–æ–≥–æ –ë–ª–æ–∫–∞ - –≤—ã–±–∏—Ä–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω—É—é —Ñ–∏–≥—É—Ä—É (1 —Ä–∞–∑ –∑–∞ –∏–≥—Ä—É)',
            –ø—Ä–æ–≤–∏–¥–µ—Ü: 'üé≤ –§–æ—Ä—Ç—É–Ω–∞ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ - –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç –ø–æ–ª–µ (1 —Ä–∞–∑ –∑–∞ –∏–≥—Ä—É)',
            –∏–Ω–∂–µ–Ω–µ—Ä: 'üîß –ü–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ –°—Ç—Ä–æ–π–∫–∏ - –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç/—É–¥–∞–ª—è–µ—Ç –ª—é–±–æ–π —Å—Ç–æ—è—â–∏–π –±–ª–æ–∫ (–∫–∞–∂–¥—ã–µ 5 —Ö–æ–¥–æ–≤)',
            –º–æ–Ω–∞—Ä—Ö—Ç–µ–Ω–µ–π: 'üåë –¢–µ–Ω–µ–≤–∞—è –ë—É—Ä—è - –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è (1 —Ä–∞–∑)\nüíÄ –í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∏–∑ –¢–µ–Ω–µ–π - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–∏–≥—Ä—ã—à–µ (1 —Ä–∞–∑)\nüï≥Ô∏è –¢–µ–Ω–µ–≤—ã–µ –ë–ª–æ–∫–∏ - –∑–∞–ø–æ–ª–Ω—è—é—Ç –ª—é–±—ã–µ –ø—É—Å—Ç–æ—Ç—ã (3 —Ä–∞–∑–∞)\nüï≥Ô∏è –¢–µ–Ω–µ–≤—ã–µ –ë–ª–æ–∫–∏ - –∑–∞–ø–æ–ª–Ω—è—é—Ç –ª—é–±—ã–µ –ø—É—Å—Ç–æ—Ç—ã (3 —Ä–∞–∑–∞)' /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –º–æ–Ω–∞—Ä—Ö–∞ —Ç–µ–Ω–µ–π */
        };

        function updateRoleDisplay() {
            const savedRole = localStorage.getItem('selectedCharacterRole');
            const roleDisplayElement = document.querySelector('.selected-role-display');

            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–ª–∞—Å—Å—ã —Ä–æ–ª–µ–π
            roleDisplayElement.classList.forEach(cls => {
                if (cls.startsWith('role-')) {
                    roleDisplayElement.classList.remove(cls);
                }
            });

            if (savedRole) {
                currentRoleDisplay.textContent = savedRole.charAt(0).toUpperCase() + savedRole.slice(1); // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–∞–º–æ –∏–º—è —Ä–æ–ª–∏
                roleDisplayElement.classList.add(`role-${savedRole.toLowerCase()}`);
            } else {
                currentRoleDisplay.textContent = '–ù–µ –≤—ã–±—Ä–∞–Ω–∞';
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–ª–∞—Å—Å –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è '–ù–µ –≤—ã–±—Ä–∞–Ω–∞', –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
            }
        }

        function checkAndShowCharacterSelection() {
            const savedRole = localStorage.getItem('selectedCharacterRole');
            const roleDisplayElement = document.querySelector('.selected-role-display');

            if (!savedRole) {
                characterSelectModal.classList.add('active');
            } else {
                console.log('–†–æ–ª—å —É–∂–µ –≤—ã–±—Ä–∞–Ω–∞: ' + savedRole);
                roleDisplayElement.classList.add(`role-${savedRole.toLowerCase()}`); // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–ª–∞—Å—Å, –µ—Å–ª–∏ —Ä–æ–ª—å —É–∂–µ –≤—ã–±—Ä–∞–Ω–∞
                if (savedRole === '–º–æ–Ω–∞—Ä—Ö—Ç–µ–Ω–µ–π') {
                    const secretCardElement = document.querySelector('[data-character="–º–æ–Ω–∞—Ä—Ö—Ç–µ–Ω–µ–π"]');
                    if (secretCardElement) {
                        secretCardElement.style.display = 'flex';
                    }
                }
            }
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        settingsBtn.addEventListener('click', () => {
            settingsModal.classList.add('active');
        });

        closeSettingsModalBtn.addEventListener('click', () => {
            settingsModal.classList.remove('active');
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å" –¥–ª—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
        reloadBtn.addEventListener('click', () => {
            reloadCount++;
            console.log('Reloads: ' + reloadCount);
            if (reloadCount >= 3) {
                const secretCardElement = document.querySelector('[data-character="–º–æ–Ω–∞—Ä—Ö—Ç–µ–Ω–µ–π"]');
                if (secretCardElement) {
                    secretCardElement.style.display = 'flex'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ä–µ—Ç–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É
                }
                alert('üéâ –°–µ–∫—Ä–µ—Ç–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ \'–ú–æ–Ω–∞—Ä—Ö –¢–µ–Ω–µ–π\' —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞!');
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫, —á—Ç–æ–±—ã –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
                reloadCount = 0;
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫
                settingsModal.classList.remove('active');
            }
        });

        // –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π –º—É–∑—ã–∫–∏ –∏ –∑–≤—É–∫–æ–≤
        musicToggle.checked = JSON.parse(localStorage.getItem('musicEnabled') || 'true');
        soundToggle.checked = JSON.parse(localStorage.getItem('soundEnabled') || 'true');

        musicToggle.addEventListener('change', () => {
            localStorage.setItem('musicEnabled', musicToggle.checked);
            console.log('–ú—É–∑—ã–∫–∞: ' + (musicToggle.checked ? '–í–∫–ª—é—á–µ–Ω–∞' : '–í—ã–∫–ª—é—á–µ–Ω–∞'));
        });

        soundToggle.addEventListener('change', () => {
            localStorage.setItem('soundEnabled', soundToggle.checked);
            console.log('–ó–≤—É–∫–∏: ' + (soundToggle.checked ? '–í–∫–ª—é—á–µ–Ω—ã' : '–í—ã–∫–ª—é—á–µ–Ω—ã'));
        });

        characterCards.forEach(card => {
            card.addEventListener('click', () => {
                characterCards.forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                selectedCharacter = card.dataset.character;
                characterDescription.textContent = characterDescriptions[selectedCharacter];
                selectCharacterBtn.disabled = false;
            });
        });

        selectCharacterBtn.addEventListener('click', () => {
            if (selectedCharacter) {
                localStorage.setItem('selectedCharacterRole', selectedCharacter);
                characterSelectModal.classList.remove('active');
                updateRoleDisplay(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞
                alert(`–í—ã –≤—ã–±—Ä–∞–ª–∏: ${selectedCharacter.charAt(0).toUpperCase() + selectedCharacter.slice(1)}!`);
            }
        });

        updateRoleDisplay(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        checkAndShowCharacterSelection(); // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞

        // JavaScript –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞
        const rankingModal = document.getElementById('rankingModal');
        const rankingList = document.getElementById('rankingList');
        const closeRankingModalBtn = document.querySelector('.btn-close-ranking-modal');

        function showRanking() {
            rankingModal.classList.add('active');
            const ranking = JSON.parse(localStorage.getItem('blockBlastRanking') || '[]');
            
            let rankingText = 'üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤:\n\n';
            
            if (ranking.length === 0) {
                rankingText += '–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤!\n–ë—É–¥—å –ø–µ—Ä–≤—ã–º! üöÄ';
            } else {
                ranking.slice(0, 5).forEach((player, index) => {
                    const medals = ['ü•á', 'ü•à', 'ü•â', '4Ô∏è‚É£', '5Ô∏è‚É£'];
                    rankingText += `${medals[index] || '‚Ä¢'} ${player.name}: ${formatNumber(player.score)} –æ—á–∫–æ–≤\n`;
                });
            }
            
            rankingText += '\nüéØ –¢–≤–æ–π —Ä–µ–∫–æ—Ä–¥: ' + formatNumber(highScore) + ' –æ—á–∫–æ–≤';
            
            rankingList.innerHTML = rankingText;
        }
        
        closeRankingModalBtn.addEventListener('click', () => {
            rankingModal.classList.remove('active');
        });
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–∏—Å–µ–ª (24313 -> 24,313)
    function formatNumber(num) {
        if (typeof num !== 'number' || isNaN(num)) {
            return '0'; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º '0', –µ—Å–ª–∏ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
        }
        return num.toLocaleString('ru-RU');
    }
    
    // –§—É–Ω–∫—Ü–∏—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã
    function startGame() {
        // alert('üéÆ –ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è!\n\n–°–æ–±–∏—Ä–∞–π –≥—Ä—É–ø–ø—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤ –∏ —Å—Ç–∞–≤—å –Ω–æ–≤—ã–µ —Ä–µ–∫–æ—Ä–¥—ã! üöÄ');
        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–∞–º–æ–π –∏–≥—Ä–µ
        window.location.href = 'game.html'; // –µ—Å–ª–∏ –∏–≥—Ä–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ
        // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ - —Å–∏–º—É–ª—è—Ü–∏—è –∏–≥—Ä—ã
        // simulateGame();
    }
</script>
</body>
</html>